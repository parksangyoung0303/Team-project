# API 기능 세부

'VF': 클라이언트가 보낸 데이터가 유효하지 않음.

'SF': 로그인 실패 (유저가 없거나 비밀번호가 틀림).

'DBE': 데이터베이스 작업 중 에러 발생.

'EU': 중복된 엔터티가 존재함 (예: 아이디, 이메일, 닉네임 등).
  
## Auth 모듈
  
### 로그인 (sign-in)

- 클라이언트로부터 요청 (클라이언트가 userId, userPassword를 포함하여 요청)
1. 클라이언트가 전송한 userId, userPassword 데이터가 유효한 데이터인지 확인 

    1.1 만약 유효한 데이터가 아니라면 'VF' 응답 처리

2. 데이터베이스의 user 테이블에서 userId에 해당하는 유저 레코드를 조회

    2.1 만약 유저 레코드가 존재하지 않으면 'SF' 응답 처리

    2.2 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리

3. 유저 레코드의 userPassword와 사용자가 입력한 userPassword가 일치하는지 확인

    3.1 만약 비밀번호가 서로 일치하지 않으면 'SF' 응답 처리

4. JWT로 된 accessToken 생성

5. 'SU' 응답처리

    5.1 반환할 데이터 - accessToken: 클라이언트가 다음 요청부터 사용할 토큰, 
    expiration: 반환해주는 토큰의 사용기간 (초 단위)

### 회원가입 (sign-up)

- 클라이언트로부터 요청 (name, userId, nick_name, userPassword, address, detailAddress, joinType, email)
1. 클라리언트가 전송한 데이터가 유효한 데이터인지 확인

    1.1 만약 유효하지 않은 데이터라면 'VF' 응답 처리


2. 데이터베이스 user 테이블에서 userId에 해당하는 유저 레코드가 존재하는지 조회

    2.1 만약 유저 레코드가 존재한다면 'EU' 응답 처리

    2.2 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리


3. 데이터베이스 user 테이블에서 nick_name에 해당하는 유저 레코드가 존재하는지 조회

    3.1 만약 유저 레코드가 존재한다면 'EU' 응답 처리

    3.2 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리


4. 데이터베이스 user 테이블에서 email에 해당하는 유저 레코드가 존재하는지 조회

    4.1 만약 유저 레코드가 존재한다면 'EU' 응답 처리

    4.2 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리


5. 클라이언트가 전송한 평문의 userPassword를 암호화


6. 클라이언트가 전송한 데이터와 암호화된 userPassword로 user 테이블에 레코드 삽입

    6.1 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리

8. 'SU' 응답 처리

### 아이디 중복 확인 (id-check)

- 클라이언트로부터 요청 (userId를 포함하여)
1. 클라이언트가 전송한 userId 데이터가 유효한 데이터인지 확인

    1.1 만약 유효하지 않은 데이터이면 'VF' 응답 처리

2. 데이터베이스 user 테이블에서 userId에 해당하는 유저 레코드가 존재하는지 조회

    2.1 만약 유저 레코드가 존재한다면 'EU' 응답 처리

    2.2 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리

3. 'SU' 응답 처리

### 닉네임 중복 확인 (nick_name-check)

- 클라이언트로부터 요청 (nick_name를 포함하여)
1. 클라이언트가 전송한 nick_name 데이터가 유효한 데이터인지 확인

    1.1 만약 유효하지 않은 데이터이면 'VF' 응답 처리

2. 데이터베이스 user 테이블에서 nick_name에 해당하는 유저 레코드가 존재하는지 조회

    2.1 만약 유저 레코드가 존재한다면 'EU' 응답 처리

    2.2 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리

3. 'SU' 응답 처리

### 이메일 중복 확인 (email-check)

- 클라이언트로부터 요청 (email을 포함하여)
1. 클라이언트가 전송한 email 데이터가 유효한 데이터인지 확인

    1.1 만약 유효하지 않은 데이터이면 'VF' 응답 처리

2. 데이터베이스 user 테이블에서 nick_name에 해당하는 유저 레코드가 존재하는지 조회

    2.1 만약 유저 레코드가 존재한다면 'EU' 응답 처리

    2.2 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리

3. 'SU' 응답 처리

### 이메일 인증번호 전송 (email-send)

1. 인증번호를 생성한다.

2. 작성해둔 이메일 양식에 인증번호를 추가하여 메일을 전송한다.

3. 생성한 인증번호를 서버에 저장한다. (이때 인증번호는 만료기간과 함께 redis에 저장하기로 한다.)

    3.1 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리

4. 'SU' 응답 처리

### 이메인 인증번호 검증
    
1. 클라이언트로부터 이메일과 입력한 인증번호를 받는다.
    
2. redis에 저장한 인증번호를 조회하여 비교한다.

    2.1 만약 데이터베이스 작업 중 에러가 발생하면 'DBE' 응답 처리

    2.2 만약 인증번호가 유효하지 않을시 'VF' 응답 처리
    
3. 조회 결과를 DTO에 담아 클라이언트로 응답을 보낸다.

4. 'SU' 응답 처리